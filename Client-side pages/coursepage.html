<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses - School Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 1rem 0;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            background: #34495e;
        }

        .page-title {
            background: white;
            padding: 2rem 0;
            text-align: center;
        }

        .page-title h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .content {
            padding: 2rem 0;
        }

        .actions {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .search-box {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .search-box input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .courses-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: bold;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #d68910;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            overflow: auto;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background: white;
            margin: 3% auto;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            position: relative;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .modal-header h2 {
            color: #2c3e50;
        }

        .close {
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close:hover {
            color: #e74c3c;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        .form-group input.valid,
        .form-group select.valid {
            border-color: #27ae60;
            background: #f0fff4;
        }

        .form-group input.invalid,
        .form-group select.invalid {
            border-color: #e74c3c;
            background: #fff5f5;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 0.3rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            color: #27ae60;
            font-size: 0.9rem;
            margin-top: 0.3rem;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-cancel {
            background: #95a5a6;
        }

        .btn-cancel:hover {
            background: #7f8c8d;
        }

        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            color: #999;
            display: none;
        }

        .no-results.show {
            display: table-row;
        }

        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                gap: 0.5rem;
            }

            .nav-links a {
                padding: 0.3rem 0.8rem;
                font-size: 0.9rem;
            }

            .search-box {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box input {
                margin-bottom: 1rem;
            }

            .courses-table {
                overflow-x: auto;
            }

            table {
                min-width: 700px;
            }

            th, td {
                padding: 0.5rem;
                font-size: 0.9rem;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.3rem;
            }

            .btn-small {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }

            .status-badge {
                padding: 0.2rem 0.6rem;
                font-size: 0.7rem;
            }

            .modal-content {
                margin: 10% 5%;
                padding: 1.5rem;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .page-title h1 {
                font-size: 1.8rem;
            }

            .container {
                padding: 0 10px;
            }

            .actions {
                padding: 1rem;
            }

            th, td {
                padding: 0.3rem;
                font-size: 0.8rem;
            }

            table {
                min-width: 650px;
            }

            .modal-content {
                margin: 5%;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">EduTrack</div>
            <ul class="nav-links">
                <li><a href="home.html">Home</a></li>
                <li><a href="students.html">Students</a></li>
                <li><a href="teachers.html">Teachers</a></li>
                <li><a href="courses.html" class="active">Courses</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="page-title">
        <div class="container">
            <h1>Course Management</h1>
            <p>Manage all courses and subjects</p>
        </div>
    </section>

    <main class="content">
        <div class="container">
            <div id="alertBox" class="alert"></div>

            <div class="actions">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search courses by name or code...">
                    <button class="btn" onclick="searchCourses()">Search</button>
                </div>
                <button class="btn btn-success" onclick="openAddModal()">Add New Course</button>
            </div>

            <div class="courses-table">
                <table>
                    <thead>
                        <tr>
                            <th>Course Code</th>
                            <th>Course Name</th>
                            <th>Teacher</th>
                            <th>Duration</th>
                            <th>Students</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="courseTableBody">
                        <!-- Course rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Add/Edit Course Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Course</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>

            <form id="courseForm" novalidate>
                <input type="hidden" id="courseIndex">

                <div class="form-group">
                    <label for="courseCode">Course Code <span class="required">*</span></label>
                    <input type="text" id="courseCode" name="courseCode" placeholder="e.g., MATH101">
                    <span class="error-message" id="courseCodeError"></span>
                    <span class="success-message" id="courseCodeSuccess">✓ Valid code</span>
                </div>

                <div class="form-group">
                    <label for="courseName">Course Name <span class="required">*</span></label>
                    <input type="text" id="courseName" name="courseName" placeholder="Enter course name">
                    <span class="error-message" id="courseNameError"></span>
                    <span class="success-message" id="courseNameSuccess">✓ Valid name</span>
                </div>

                <div class="form-group">
                    <label for="courseTeacher">Teacher <span class="required">*</span></label>
                    <select id="courseTeacher" name="courseTeacher">
                        <option value="">Select Teacher</option>
                        <option value="Shweta Ramani">Shweta Ramani</option>
                        <option value="Drashti Chovatiya">Drashti Chovatiya</option>
                        <option value="Ajay Pachani">Ajay Pachani</option>
                        <option value="Kishan Mavani">Kishan Mavani</option>
                        <option value="Bhargav Thaker">Bhargav Thaker</option>
                    </select>
                    <span class="error-message" id="courseTeacherError"></span>
                    <span class="success-message" id="courseTeacherSuccess">✓ Selected</span>
                </div>

                <div class="form-group">
                    <label for="courseDuration">Duration <span class="required">*</span></label>
                    <select id="courseDuration" name="courseDuration">
                        <option value="">Select Duration</option>
                        <option value="1 Semester">1 Semester</option>
                        <option value="2 Semesters">2 Semesters</option>
                        <option value="1 Year">1 Year</option>
                        <option value="2 Years">2 Years</option>
                    </select>
                    <span class="error-message" id="courseDurationError"></span>
                    <span class="success-message" id="courseDurationSuccess">✓ Selected</span>
                </div>

                <div class="form-group">
                    <label for="courseStudents">Number of Students <span class="required">*</span></label>
                    <input type="number" id="courseStudents" name="courseStudents" placeholder="Enter number of students" min="0" max="100">
                    <span class="error-message" id="courseStudentsError"></span>
                    <span class="success-message" id="courseStudentsSuccess">✓ Valid</span>
                </div>

                <div class="form-group">
                    <label for="courseStatus">Status <span class="required">*</span></label>
                    <select id="courseStatus" name="courseStatus">
                        <option value="">Select Status</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                    <span class="error-message" id="courseStatusError"></span>
                    <span class="success-message" id="courseStatusSuccess">✓ Selected</span>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Save Course</button>
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 EduTrack. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Sample course data
        let courses = [
            { code: 'MATH101', name: 'Advanced Mathematics', teacher: 'Shweta Ramani', duration: '1 Semester', students: 25, status: 'Active' },
            { code: 'ENG102', name: 'English Literature', teacher: 'Drashti Chovatiya', duration: '1 Year', students: 30, status: 'Active' },
            { code: 'PHY103', name: 'Physics Fundamentals', teacher: 'Ajay Pachani', duration: '1 Semester', students: 22, status: 'Active' },
            { code: 'CHEM104', name: 'Organic Chemistry', teacher: 'Kishan Mavani', duration: '1 Semester', students: 18, status: 'Inactive' },
            { code: 'BIO105', name: 'Biology Basics', teacher: 'Bhargav Thaker', duration: '1 Year', students: 28, status: 'Active' }
        ];

        let isEditMode = false;
        let editIndex = -1;

        // Initialize page
        window.onload = function() {
            renderCourses();
            setupValidation();
        };

        // Render courses table
        function renderCourses(filteredCourses = courses) {
            const tbody = document.getElementById('courseTableBody');
            tbody.innerHTML = '';

            if (filteredCourses.length === 0) {
                tbody.innerHTML = '<tr class="no-results show"><td colspan="7">No courses found</td></tr>';
                return;
            }

            filteredCourses.forEach((course, index) => {
                const row = document.createElement('tr');
                const statusClass = course.status === 'Active' ? 'status-active' : 'status-inactive';
                
                row.innerHTML = `
                    <td>${course.code}</td>
                    <td>${course.name}</td>
                    <td>${course.teacher}</td>
                    <td>${course.duration}</td>
                    <td>${course.students}</td>
                    <td><span class="status-badge ${statusClass}">${course.status}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-small" onclick="viewCourse(${courses.indexOf(course)})">View</button>
                        <button class="btn btn-warning btn-small" onclick="editCourse(${courses.indexOf(course)})">Edit</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCourse(${courses.indexOf(course)})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Search courses
        function searchCourses() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                renderCourses();
                return;
            }

            const filtered = courses.filter(course =>
                course.name.toLowerCase().includes(searchTerm) ||
                course.code.toLowerCase().includes(searchTerm) ||
                course.teacher.toLowerCase().includes(searchTerm)
            );

            renderCourses(filtered);
        }

        // Search on Enter key
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchCourses();
            }
        });

        // Open add modal
        function openAddModal() {
            isEditMode = false;
            document.getElementById('modalTitle').textContent = 'Add New Course';
            document.getElementById('courseForm').reset();
            clearAllValidation();
            document.getElementById('courseModal').classList.add('show');
        }

        // Open edit modal
        function editCourse(index) {
            isEditMode = true;
            editIndex = index;
            const course = courses[index];

            document.getElementById('modalTitle').textContent = 'Edit Course';
            document.getElementById('courseIndex').value = index;
            document.getElementById('courseCode').value = course.code;
            document.getElementById('courseName').value = course.name;
            document.getElementById('courseTeacher').value = course.teacher;
            document.getElementById('courseDuration').value = course.duration;
            document.getElementById('courseStudents').value = course.students;
            document.getElementById('courseStatus').value = course.status;

            clearAllValidation();
            document.getElementById('courseModal').classList.add('show');
        }

        // View course
        function viewCourse(index) {
            const course = courses[index];
            alert(`Course Details:\n\nCode: ${course.code}\nName: ${course.name}\nTeacher: ${course.teacher}\nDuration: ${course.duration}\nStudents: ${course.students}\nStatus: ${course.status}`);
        }

        // Delete course
        function deleteCourse(index) {
            const course = courses[index];
            
            if (confirm(`Are you sure you want to delete ${course.name}?\n\nThis action cannot be undone.`)) {
                courses.splice(index, 1);
                renderCourses();
                showAlert('Course deleted successfully!', 'success');
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('courseModal').classList.remove('show');
            document.getElementById('courseForm').reset();
            clearAllValidation();
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('courseModal');
            if (event.target === modal) {
                closeModal();
            }
        };

        // Show alert
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = 'alert show alert-' + type;
            alertBox.scrollIntoView({ behavior: 'smooth', block: 'center' });

            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }

        // Validation functions
        function showError(input, message) {
            const errorElement = document.getElementById(input.id + 'Error');
            const successElement = document.getElementById(input.id + 'Success');
            
            input.classList.add('invalid');
            input.classList.remove('valid');
            errorElement.textContent = message;
            errorElement.classList.add('show');
            
            if (successElement) {
                successElement.classList.remove('show');
            }
        }

        function showSuccess(input) {
            const errorElement = document.getElementById(input.id + 'Error');
            const successElement = document.getElementById(input.id + 'Success');
            
            input.classList.add('valid');
            input.classList.remove('invalid');
            errorElement.classList.remove('show');
            
            if (successElement) {
                successElement.classList.add('show');
            }
        }

        function clearValidation(input) {
            const errorElement = document.getElementById(input.id + 'Error');
            const successElement = document.getElementById(input.id + 'Success');
            
            input.classList.remove('valid', 'invalid');
            if (errorElement) errorElement.classList.remove('show');
            if (successElement) successElement.classList.remove('show');
        }

        function clearAllValidation() {
            const inputs = ['courseCode', 'courseName', 'courseTeacher', 'courseDuration', 'courseStudents', 'courseStatus'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) clearValidation(input);
            });
        }

        // Validate Course Code
        function validateCourseCode() {
            const input = document.getElementById('courseCode');
            const value = input.value.trim().toUpperCase();

            if (value === '') {
                showError(input, 'Course code is required');
                return false;
            }

            // Course code format: 3-4 letters followed by 3 digits
            if (!/^[A-Z]{3,4}\d{3}$/.test(value)) {
                showError(input, 'Course code must be 3-4 letters followed by 3 digits (e.g., MATH101)');
                return false;
            }

            // Check for duplicate code (except in edit mode)
            const isDuplicate = courses.some((course, index) => 
                course.code === value && (!isEditMode || index !== editIndex)
            );

            if (isDuplicate) {
                showError(input, 'This course code already exists');
                return false;
            }

            showSuccess(input);
            return true;
        }

        // Validate Course Name
        function validateCourseName() {
            const input = document.getElementById('courseName');
            const value = input.value.trim();

            if (value === '') {
                showError(input, 'Course name is required');
                return false;
            }

            if (value.length < 3) {
                showError(input, 'Course name must be at least 3 characters');
                return false;
            }

            if (value.length > 100) {
                showError(input, 'Course name must be less than 100 characters');
                return false;
            }

            // Allow letters, numbers, spaces, and common punctuation
            const nameRegex = /^[a-zA-Z0-9\s\-\&\(\)\.]+$/;
            if (!nameRegex.test(value)) {
                showError(input, 'Course name can only contain letters, numbers, spaces, and basic punctuation');
                return false;
            }

            showSuccess(input);
            return true;
        }

        // Validate Teacher
        function validateCourseTeacher() {
            const input = document.getElementById('courseTeacher');
            const value = input.value;

            if (value === '') {
                showError(input, 'Please select a teacher');
                return false;
            }

            showSuccess(input);
            return true;
        }

        // Validate Duration
        function validateCourseDuration() {
            const input = document.getElementById('courseDuration');
            const value = input.value;

            if (value === '') {
                showError(input, 'Please select course duration');
                return false;
            }

            showSuccess(input);
            return true;
        }

        // Validate Students
        function validateCourseStudents() {
            const input = document.getElementById('courseStudents');
            const value = input.value.trim();

            if (value === '') {
                showError(input, 'Number of students is required');
                return false;
            }

            const students = parseInt(value);

            if (isNaN(students) || students < 0) {
                showError(input, 'Number of students must be a positive number');
                return false;
            }

            if (students > 100) {
                showError(input, 'Number of students cannot exceed 100');
                return false;
            }

            showSuccess(input);
            return true;
        }

        // Validate Status
        function validateCourseStatus() {
            const input = document.getElementById('courseStatus');
            const value = input.value;

            if (value === '') {
                showError(input, 'Please select course status');
                return false;
            }

            showSuccess(input);
            return true;
        }

        // Setup validation
        function setupValidation() {
            const courseCode = document.getElementById('courseCode');
            const courseName = document.getElementById('courseName');
            const courseTeacher = document.getElementById('courseTeacher');
            const courseDuration = document.getElementById('courseDuration');
            const courseStudents = document.getElementById('courseStudents');
            const courseStatus = document.getElementById('courseStatus');

            // Blur validation
            courseCode.addEventListener('blur', validateCourseCode);
            courseName.addEventListener('blur', validateCourseName);
            courseTeacher.addEventListener('blur', validateCourseTeacher);
            courseDuration.addEventListener('blur', validateCourseDuration);
            courseStudents.addEventListener('blur', validateCourseStudents);
            courseStatus.addEventListener('blur', validateCourseStatus);

            // Clear validation on input
            courseCode.addEventListener('input', () => clearValidation(courseCode));
            courseName.addEventListener('input', () => clearValidation(courseName));
            courseTeacher.addEventListener('input', () => clearValidation(courseTeacher));
            courseDuration.addEventListener('input', () => clearValidation(courseDuration));
            courseStudents.addEventListener('input', () => clearValidation(courseStudents));
            courseStatus.addEventListener('input', () => clearValidation(courseStatus));

            // Course code formatting
            courseCode.addEventListener('input', function() {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });

            // Limit students input
            courseStudents.addEventListener('input', function() {
                if (this.value < 0) this.value = 0;
                if (this.value > 100) this.value = 100;
            });

            // XSS prevention
            const textInputs = [courseCode, courseName];
            textInputs.forEach(input => {
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/<[^>]*>/g, '');
                });
            });
        }

        // Form submission
        document.getElementById('courseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate all fields
            const isCodeValid = validateCourseCode();
            const isNameValid = validateCourseName();
            const isTeacherValid = validateCourseTeacher();
            const isDurationValid = validateCourseDuration();
            const isStudentsValid = validateCourseStudents();
            const isStatusValid = validateCourseStatus();

            if (isCodeValid && isNameValid && isTeacherValid && isDurationValid && isStudentsValid && isStatusValid) {
                const courseData = {
                    code: document.getElementById('courseCode').value.trim().toUpperCase(),
                    name: document.getElementById('courseName').value.trim(),
                    teacher: document.getElementById('courseTeacher').value,
                    duration: document.getElementById('courseDuration').value,
                    students: parseInt(document.getElementById('courseStudents').value),
                    status: document.getElementById('courseStatus').value
                };

                if (isEditMode) {
                    courses[editIndex] = courseData;
                    showAlert('Course updated successfully!', 'success');
                } else {
                    courses.push(courseData);
                    showAlert('Course added successfully!', 'success');
                }

                renderCourses();
                closeModal();
            } else {
                showAlert('Please fix all errors before submitting', 'error');
                
                // Focus on first invalid field
                if (!isCodeValid) document.getElementById('courseCode').focus();
                else if (!isNameValid) document.getElementById('courseName').focus();
                else if (!isTeacherValid) document.getElementById('courseTeacher').focus();
                else if (!isDurationValid) document.getElementById('courseDuration').focus();
                else if (!isStudentsValid) document.getElementById('courseStudents').focus();
                else if (!isStatusValid) document.getElementById('courseStatus').focus();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape key to close modal
            if (e.key === 'Escape') {
                const modal = document.getElementById('courseModal');
                if (modal.classList.contains('show')) {
                    closeModal();
                }
            }
            
            // Ctrl/Cmd + K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            
            // Ctrl/Cmd + N to add new course
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openAddModal();
            }
        });

        // Filter by status
        function filterByStatus(status) {
            if (status === 'all') {
                renderCourses();
                return;
            }
            
            const filtered = courses.filter(course => 
                course.status.toLowerCase() === status.toLowerCase()
            );
            renderCourses(filtered);
        }

        // Sort courses
        function sortCourses(field, order = 'asc') {
            const sorted = [...courses].sort((a, b) => {
                let valueA = a[field];
                let valueB = b[field];
                
                // Handle numeric fields
                if (field === 'students') {
                    valueA = parseInt(valueA);
                    valueB = parseInt(valueB);
                }
                
                // Handle string fields
                if (typeof valueA === 'string') {
                    valueA = valueA.toLowerCase();
                    valueB = valueB.toLowerCase();
                }
                
                if (order === 'asc') {
                    return valueA > valueB ? 1 : valueA < valueB ? -1 : 0;
                } else {
                    return valueA < valueB ? 1 : valueA > valueB ? -1 : 0;
                }
            });
            
            renderCourses(sorted);
        }

        // Export to CSV (optional feature)
        function exportToCSV() {
            if (courses.length === 0) {
                alert('No courses to export');
                return;
            }
            
            let csv = 'Course Code,Course Name,Teacher,Duration,Students,Status\n';
            
            courses.forEach(course => {
                csv += `${course.code},"${course.name}",${course.teacher},${course.duration},${course.students},${course.status}\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'courses_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showAlert('Courses exported successfully!', 'success');
        }

        // Print course list
        function printCourses() {
            if (courses.length === 0) {
                alert('No courses to print');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Course List - EduTrack</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            padding: 20px;
                        }
                        h1 {
                            text-align: center;
                            color: #2c3e50;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 12px;
                            text-align: left;
                        }
                        th {
                            background-color: #2c3e50;
                            color: white;
                        }
                        tr:nth-child(even) {
                            background-color: #f2f2f2;
                        }
                        .active {
                            color: #27ae60;
                            font-weight: bold;
                        }
                        .inactive {
                            color: #e74c3c;
                            font-weight: bold;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            color: #7f8c8d;
                            font-size: 12px;
                        }
                    </style>
                </head>
                <body>
                    <h1>EduTrack - Course List</h1>
                    <p><strong>Generated on:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>Total Courses:</strong> ${courses.length}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Course Code</th>
                                <th>Course Name</th>
                                <th>Teacher</th>
                                <th>Duration</th>
                                <th>Students</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            courses.forEach(course => {
                const statusClass = course.status === 'Active' ? 'active' : 'inactive';
                html += `
                    <tr>
                        <td>${course.code}</td>
                        <td>${course.name}</td>
                        <td>${course.teacher}</td>
                        <td>${course.duration}</td>
                        <td>${course.students}</td>
                        <td class="${statusClass}">${course.status}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>&copy; 2025 EduTrack. All rights reserved.</p>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(html);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }

        // Get course statistics
        function getCourseStats() {
            const totalCourses = courses.length;
            const activeCourses = courses.filter(c => c.status === 'Active').length;
            const inactiveCourses = courses.filter(c => c.status === 'Inactive').length;
            const totalStudents = courses.reduce((sum, c) => sum + c.students, 0);
            const avgStudents = totalCourses > 0 ? (totalStudents / totalCourses).toFixed(1) : 0;
            
            alert(`Course Statistics:\n\nTotal Courses: ${totalCourses}\nActive Courses: ${activeCourses}\nInactive Courses: ${inactiveCourses}\nTotal Students: ${totalStudents}\nAverage Students per Course: ${avgStudents}`);
        }

        // Validate before delete - check if course has students
        function validateDelete(index) {
            const course = courses[index];
            
            if (course.students > 0) {
                const confirmMsg = `Warning: This course has ${course.students} enrolled students.\n\nAre you sure you want to delete "${course.name}"?\n\nThis action cannot be undone.`;
                return confirm(confirmMsg);
            }
            
            return confirm(`Are you sure you want to delete "${course.name}"?\n\nThis action cannot be undone.`);
        }

        // Update delete function to use validation
        function deleteCourse(index) {
            if (validateDelete(index)) {
                courses.splice(index, 1);
                renderCourses();
                showAlert('Course deleted successfully!', 'success');
            }
        }

        // Auto-save warning before leaving page
        let hasUnsavedChanges = false;

        // Mark form as dirty when changes are made
        document.getElementById('courseForm').addEventListener('input', function() {
            hasUnsavedChanges = true;
        });

        // Clear dirty flag on successful submit
        document.getElementById('courseForm').addEventListener('submit', function() {
            hasUnsavedChanges = false;
        });

        // Warn before leaving with unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                const message = 'You have unsaved changes. Are you sure you want to leave?';
                e.returnValue = message;
                return message;
            }
        });

        // Reset dirty flag when modal closes
        const originalCloseModal = closeModal;
        closeModal = function() {
            if (hasUnsavedChanges) {
                if (confirm('You have unsaved changes. Are you sure you want to close?')) {
                    hasUnsavedChanges = false;
                    originalCloseModal();
                }
            } else {
                originalCloseModal();
            }
        };

        // Additional validation helper - check for course name similarity
        function checkSimilarCourseName(name) {
            const similar = courses.filter(course => {
                const similarity = calculateSimilarity(course.name.toLowerCase(), name.toLowerCase());
                return similarity > 0.8 && course.name.toLowerCase() !== name.toLowerCase();
            });
            
            if (similar.length > 0) {
                const names = similar.map(c => c.name).join(', ');
                return confirm(`Similar course names found: ${names}\n\nDo you want to continue?`);
            }
            
            return true;
        }

        // Simple string similarity calculation
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = getEditDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        // Calculate edit distance between two strings
        function getEditDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        // Initialize tooltips or help text
        function initializeHelpText() {
            const courseCode = document.getElementById('courseCode');
            courseCode.title = 'Format: 3-4 letters followed by 3 digits (e.g., MATH101, ENG102)';
            
            const courseName = document.getElementById('courseName');
            courseName.title = 'Enter the full name of the course';
            
            const courseStudents = document.getElementById('courseStudents');
            courseStudents.title = 'Maximum 100 students per course';
        }

        // Call initialization
        initializeHelpText();

        // Log activity (optional - for debugging)
        function logActivity(action, details) {
            const timestamp = new Date().toISOString();
            console.log(`[${timestamp}] ${action}:`, details);
        }

        // Override functions to include logging
        const originalAddCourse = openAddModal;
        openAddModal = function() {
            logActivity('Open Add Modal', 'User opened add course form');
            originalAddCourse();
        };

        console.log('Course Management System initialized successfully');
        console.log(`Total courses loaded: ${courses.length}`);
    </script>
</body>
</html>